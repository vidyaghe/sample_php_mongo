language: php

php: 
  - 5.4

services:
  - mongodb
  
env:
 global:
  - secure: K0cIiZlxi1qkrHuB845n8ozDuP8RCXCk42xyoqKpfcvYs6nnvS1SpIYqZwVysXO3cpgNJ6L2CaPS15++oAiqtWf+9/dNuZZQhtZi6fSp3nLLBtkqmlbKg4VcFhm8EJbwwDDsyX2+zJZGSdqxMjntRB9wGpJJSs+nkSDOrrTe88T2ILqFzpXWTMef8o1FzDhPA/jAll9Nrqvf8+LXyOzxKxP3FPKHsD56leRbjVIMSljxxb9rNHCORx/X0VplTxPKZqSZLzsVuC/RMfp5qZUWVnw+Ccf/UxGnIJIlFCDbnQKXhXuWXGtYTVwCWwYlEkV/fcJuxoiAAuAmRM5FS0mEwA==

before_script: 
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - tar -xzf mongo-1.5.2.tgz
  - sh -c "cd mongo-1.5.2/mongo-1.5.2 && phpize && ./configure && make install"
  - echo "extension=mongo.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
script:
  - phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage tests/ConnectToMongoTest.php
  
after_script:
  - echo $sec
notifications:
   email: false

archive: true

branches:
 except:
  - test-exclude-branch
notifications:
 email:
   recipients:
     - "vidya@shippable.com"
   on_success: always
   on_failure: change
